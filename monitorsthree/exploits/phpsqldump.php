<?php

// Database connection parameters
$host = 'localhost';
$user = 'cactiuser';
$password = 'cactiuser';
$port = 3306;

// Directory to store dumps
$dumpDir = '.';

// Create directory if it does not exist
if (!file_exists($dumpDir)) {
    mkdir($dumpDir, 0755, true);
}

try {
    // Connect to MySQL server
    $pdo = new PDO("mysql:host=$host;port=$port", $user, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    // Get list of databases
    $stmt = $pdo->query('SHOW DATABASES');
    $databases = $stmt->fetchAll(PDO::FETCH_COLUMN);

    foreach ($databases as $db) {
        // Skip the default databases if necessary
        if (in_array($db, ['information_schema', 'mysql', 'performance_schema', 'sys'])) {
            continue;
        }

        // Create dump file path
        $dumpFile = "$dumpDir/{$db}.sql";

        // Build mysqldump command
        $command = "mysqldump --user=$user --password=$password --host=$host --port=$port $db > $dumpFile";

        // Execute mysqldump command
        exec($command, $output, $return_var);

        if ($return_var === 0) {
            echo "Successfully dumped database: $db\n";
        } else {
            echo "Error dumping database: $db\n";
        }
    }

} catch (PDOException $e) {
    echo 'Connection failed: ' . $e->getMessage();
}

?>
